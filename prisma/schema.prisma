generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  name          String?
  password      String?
  role          String         @default("USER")
  image         String?
  phone         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  bankAccount   String?
  bankHolder    String?
  bankName      String?
  inquiries     Inquiry[]
  offers        Offer[]
  offerMessages OfferHistory[]
  properties    Property[]
  purchases     Transaction[]  @relation("BuyerTransactions")
  sales         Transaction[]  @relation("SellerTransactions")
  wishlists     Wishlist[]
}

model Agent {
  id         String     @id @default(cuid())
  name       String
  email      String     @unique
  phone      String
  photo      String?
  bio        String?
  company    String?
  verified   Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  properties Property[]
}

model Property {
  id             String             @id @default(cuid())
  title          String
  slug           String?            @unique
  description    String
  price          Decimal
  location       String
  address        String
  bedrooms       Int
  bathrooms      Int
  area           Float
  landArea       Float?
  type           String
  status         String
  images         String
  featured       Boolean            @default(false)
  latitude       Float?
  longitude      Float?
  views          Int                @default(0)
  certificate    String?
  condition      String?
  furnishing     String?
  floors         Int?
  agentId        String?
  userId         String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  mapsEmbed      String?
  videoUrl       String?
  virtualTourUrl String?
  inquiries      Inquiry[]
  offers         Offer[]
  user           User?              @relation(fields: [userId], references: [id])
  agent          Agent?             @relation(fields: [agentId], references: [id])
  facilities     PropertyFacility[]
  propertyImages PropertyImage[]
  transactions   Transaction[]
  wishlists      Wishlist[]
}

model PropertyImage {
  id         String   @id @default(cuid())
  url        String
  caption    String?
  isPrimary  Boolean  @default(false)
  sortOrder  Int      @default(0)
  propertyId String
  createdAt  DateTime @default(now())
  hash       String?
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Facility {
  id         String             @id @default(cuid())
  name       String             @unique
  icon       String?
  category   String?
  createdAt  DateTime           @default(now())
  properties PropertyFacility[]
}

model PropertyFacility {
  id         String   @id @default(cuid())
  propertyId String
  facilityId String
  facility   Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, facilityId])
}

model Wishlist {
  id         String   @id @default(cuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
}

model Inquiry {
  id         String   @id @default(cuid())
  name       String
  email      String
  phone      String?
  message    String
  isRead     Boolean  @default(false)
  isReplied  Boolean  @default(false)
  propertyId String
  userId     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User?    @relation(fields: [userId], references: [id])
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Transaction {
  id              String    @id @default(cuid())
  amount          Decimal
  status          String    @default("PENDING")
  paymentProofUrl String?
  paidAt          DateTime?
  propertyTitle   String?
  propertyId      String
  buyerId         String
  sellerId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  property        Property  @relation(fields: [propertyId], references: [id])
  buyer           User      @relation("BuyerTransactions", fields: [buyerId], references: [id])
  seller          User      @relation("SellerTransactions", fields: [sellerId], references: [id])
}

model Offer {
  id         String         @id @default(cuid())
  amount     Decimal
  status     String         @default("PENDING")
  userId     String
  propertyId String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  property   Property       @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user       User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  history    OfferHistory[]
}

model OfferHistory {
  id        String   @id @default(cuid())
  offerId   String
  senderId  String
  price     Decimal?
  message   String?
  action    String
  createdAt DateTime @default(now())
  sender    User     @relation(fields: [senderId], references: [id], onDelete: Cascade)
  offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)
}
